{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Documents\\\\lostnfound_fullstack\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios'; // Used for making API calls to your backend\n\n// 1. Create the Context object\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\n\n// Placeholder for your backend authentication URL\n// Update API_URL to use HTTPS and the correct path for login.\n// Replace 'yourdomain.com' with your actual domain name once deployed. \n// For local development, use http://localhost:3000\nconst API_URL = 'http://localhost:3000/api/auth';\nconst LOGIN_API_URL = `${API_URL}/login`; // Will be the POST endpoint\n\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  // State variables for tracking authentication status\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [role, setRole] = useState(null); // Key for authorization: 'user' or 'admin'\n  const [isLoading, setIsLoading] = useState(true);\n\n  // --- Initial Check (Runs once when the app loads) ---\n  useEffect(() => {\n    // Check if we have stored credentials (token and role) from a previous session\n    const token = sessionStorage.getItem('authToken');\n    const storedRole = sessionStorage.getItem('userRole');\n    if (token && storedRole) {\n      // --- Token Verification ---\n      // We use a simple GET request to verify the stored token is still valid\n      axios.get(`${API_URL}/verify-token`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }).then(response => {\n        // If the token is valid, the backend should return user data including the role\n        setUser(response.data.user);\n        setRole(response.data.user.role);\n        setIsAuthenticated(true);\n      }).catch(() => {\n        logout(); // Token failed verification or expired\n      }).finally(() => setIsLoading(false));\n\n      /* // CHANGE 3: DELETE/COMMENT OUT the testing simulation logic\r\n      // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n      setUser({ name: 'Reloaded User', role: storedRole });\r\n      setRole(storedRole);\r\n      setIsAuthenticated(true);\r\n      // *** END TESTING SIMULATION LOGIC ***\r\n      */\n    } else {\n      // Only call this if no token was found\n      setIsLoading(false);\n    }\n  }, []);\n\n  // --- Login Function ---\n  const login = async (email, password) => {\n    setIsLoading(true);\n\n    // --- Login Request ---\n    try {\n      // Make the actual request to your backend login route (now using POST)\n      const response = await axios.post(LOGIN_API_URL, {\n        email,\n        password\n      });\n\n      // Expect token, user object, and role from the backend\n      const {\n        token,\n        user\n      } = response.data;\n\n      // CRUCIAL: Store the token and the role\n      sessionStorage.setItem('authToken', token);\n      sessionStorage.setItem('userRole', user.role); // Store the actual role ('user' or 'admin')\n\n      setUser(user);\n      setRole(user.role);\n      setIsAuthenticated(true);\n      setIsLoading(false);\n      return true; // Success\n    } catch (error) {\n      var _error$response, _error$response$data;\n      // Catch network or server-side errors and extract the error message\n      const errorMessage = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Login failed. Network error or server down.';\n      return errorMessage;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  /* // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n  await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network delay\r\n  \r\n  const simulatedRole = email.toLowerCase().includes('admin') ? 'admin' : 'user';\r\n  \r\n  // Simulate successful login\r\n  localStorage.setItem('authToken', 'fake_jwt_token'); \r\n  localStorage.setItem('userRole', simulatedRole); \r\n  \r\n  setUser({ id: 1, name: email, role: simulatedRole });\r\n  setRole(simulatedRole);\r\n  setIsAuthenticated(true);\r\n  setIsLoading(false);\r\n  return true; \r\n  // *** END TESTING SIMULATION LOGIC ***\r\n  };*/\n\n  // --- Logout Function ---\n  const logout = () => {\n    // Clear storage and reset state\n    sessionStorage.removeItem('authToken');\n    sessionStorage.removeItem('userRole');\n    setUser(null);\n    setRole(null);\n    setIsAuthenticated(false);\n    setIsLoading(false);\n  };\n\n  // The object that makes the state and functions available to the app\n  const contextValue = {\n    user,\n    isAuthenticated,\n    role,\n    isLoading,\n    login,\n    logout,\n    token: sessionStorage.getItem('authToken') // Retrieves token from session storage\n  };\n\n  // If the initial check is running, display a loading screen\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"PLEASE WAIT YA :D\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextValue,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n};\n\n// Custom hook to use the AuthContext easily in any component\n_s(AuthProvider, \"Y//1urkmC11BV/kKPPRntNn2Gso=\");\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n  return useContext(AuthContext);\n};\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsxDEV","_jsxDEV","AuthContext","API_URL","LOGIN_API_URL","AuthProvider","children","_s","user","setUser","isAuthenticated","setIsAuthenticated","role","setRole","isLoading","setIsLoading","token","sessionStorage","getItem","storedRole","get","headers","Authorization","then","response","data","catch","logout","finally","login","email","password","post","setItem","error","_error$response","_error$response$data","errorMessage","message","removeItem","contextValue","fileName","_jsxFileName","lineNumber","columnNumber","Provider","value","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/Users/User/Documents/lostnfound_fullstack/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport axios from 'axios'; // Used for making API calls to your backend\r\n\r\n// 1. Create the Context object\r\nconst AuthContext = createContext(null);\r\n\r\n// Placeholder for your backend authentication URL\r\n// Update API_URL to use HTTPS and the correct path for login.\r\n// Replace 'yourdomain.com' with your actual domain name once deployed. \r\n// For local development, use http://localhost:3000\r\nconst API_URL = 'http://localhost:3000/api/auth'; \r\nconst LOGIN_API_URL = `${API_URL}/login`; // Will be the POST endpoint\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  // State variables for tracking authentication status\r\n  const [user, setUser] = useState(null);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [role, setRole] = useState(null); // Key for authorization: 'user' or 'admin'\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // --- Initial Check (Runs once when the app loads) ---\r\n  useEffect(() => {\r\n    // Check if we have stored credentials (token and role) from a previous session\r\n    const token = sessionStorage.getItem('authToken');\r\n    const storedRole = sessionStorage.getItem('userRole');\r\n\r\n    if (token && storedRole) {\r\n      \r\n      // --- Token Verification ---\r\n      // We use a simple GET request to verify the stored token is still valid\r\n      axios.get(`${API_URL}/verify-token`, { headers: { Authorization: `Bearer ${token}` }})\r\n        .then(response => {\r\n          // If the token is valid, the backend should return user data including the role\r\n          setUser(response.data.user); \r\n          setRole(response.data.user.role);\r\n          setIsAuthenticated(true);\r\n        })\r\n        .catch(() => {\r\n          logout(); // Token failed verification or expired\r\n        })\r\n        .finally(() => setIsLoading(false));\r\n      \r\n      /* // CHANGE 3: DELETE/COMMENT OUT the testing simulation logic\r\n      // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n      setUser({ name: 'Reloaded User', role: storedRole });\r\n      setRole(storedRole);\r\n      setIsAuthenticated(true);\r\n      // *** END TESTING SIMULATION LOGIC ***\r\n      */\r\n    } else {\r\n        // Only call this if no token was found\r\n        setIsLoading(false); \r\n    }\r\n  }, []);\r\n\r\n  // --- Login Function ---\r\n  const login = async (email, password) => {\r\n    setIsLoading(true);\r\n    \r\n    // --- Login Request ---\r\n    try {\r\n      // Make the actual request to your backend login route (now using POST)\r\n      const response = await axios.post(LOGIN_API_URL, { email, password });\r\n      \r\n      // Expect token, user object, and role from the backend\r\n      const { token, user } = response.data;\r\n      \r\n      // CRUCIAL: Store the token and the role\r\n      sessionStorage.setItem('authToken', token);\r\n      sessionStorage.setItem('userRole', user.role); // Store the actual role ('user' or 'admin')\r\n      \r\n      setUser(user);\r\n      setRole(user.role);\r\n      setIsAuthenticated(true);\r\n      setIsLoading(false);\r\n      return true; // Success\r\n\r\n    } catch (error) {\r\n      // Catch network or server-side errors and extract the error message\r\n      const errorMessage = error.response?.data?.message || 'Login failed. Network error or server down.';\r\n      return errorMessage; \r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n    /* // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n    await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network delay\r\n    \r\n    const simulatedRole = email.toLowerCase().includes('admin') ? 'admin' : 'user';\r\n    \r\n    // Simulate successful login\r\n    localStorage.setItem('authToken', 'fake_jwt_token'); \r\n    localStorage.setItem('userRole', simulatedRole); \r\n    \r\n    setUser({ id: 1, name: email, role: simulatedRole });\r\n    setRole(simulatedRole);\r\n    setIsAuthenticated(true);\r\n    setIsLoading(false);\r\n    return true; \r\n    // *** END TESTING SIMULATION LOGIC ***\r\n  };*/\r\n\r\n  // --- Logout Function ---\r\n  const logout = () => {\r\n    // Clear storage and reset state\r\n    sessionStorage.removeItem('authToken'); \r\n    sessionStorage.removeItem('userRole');\r\n    \r\n    setUser(null);\r\n    setRole(null);\r\n    setIsAuthenticated(false);\r\n    setIsLoading(false);\r\n  };\r\n\r\n  // The object that makes the state and functions available to the app\r\n  const contextValue = {\r\n    user,\r\n    isAuthenticated,\r\n    role,\r\n    isLoading,\r\n    login,\r\n    logout,\r\n    token: sessionStorage.getItem('authToken'), // Retrieves token from session storage\r\n  };\r\n\r\n  // If the initial check is running, display a loading screen\r\n  if (isLoading) {\r\n    return <h1>PLEASE WAIT YA :D</h1>; \r\n  }\r\n\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Custom hook to use the AuthContext easily in any component\r\nexport const useAuth = () => {\r\n  return useContext(AuthContext);\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}