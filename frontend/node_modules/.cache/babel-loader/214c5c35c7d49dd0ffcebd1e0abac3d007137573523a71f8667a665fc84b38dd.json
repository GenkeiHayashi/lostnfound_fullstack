{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';// Used for making API calls to your backend\n// 1. Create the Context object\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);// Placeholder for your backend authentication URL\n// Update API_URL to use HTTPS and the correct path for login.\n// Replace 'yourdomain.com' with your actual domain name once deployed. \n// For local development, use http://localhost:3000\nconst API_URL='http://localhost:3000/api/auth';const LOGIN_API_URL=\"\".concat(API_URL,\"/login\");// Will be the POST endpoint\nexport const AuthProvider=_ref=>{let{children}=_ref;// State variables for tracking authentication status\nconst[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[role,setRole]=useState(null);// Key for authorization: 'user' or 'admin'\nconst[isLoading,setIsLoading]=useState(true);// --- Initial Check (Runs once when the app loads) ---\nuseEffect(()=>{// Check if we have stored credentials (token and role) from a previous session\nconst token=sessionStorage.getItem('authToken');const storedRole=sessionStorage.getItem('userRole');if(token&&storedRole){// --- Token Verification ---\n// We use a simple GET request to verify the stored token is still valid\naxios.get(\"\".concat(API_URL,\"/verify-token\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(response=>{// If the token is valid, the backend should return user data including the role\nsetUser(response.data.user);setRole(response.data.user.role);setIsAuthenticated(true);}).catch(()=>{logout();// Token failed verification or expired\n}).finally(()=>setIsLoading(false));/* // CHANGE 3: DELETE/COMMENT OUT the testing simulation logic\r\n      // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n      setUser({ name: 'Reloaded User', role: storedRole });\r\n      setRole(storedRole);\r\n      setIsAuthenticated(true);\r\n      // *** END TESTING SIMULATION LOGIC ***\r\n      */}else{// Only call this if no token was found\nsetIsLoading(false);}},[]);// --- Login Function ---\nconst login=async(email,password)=>{setIsLoading(true);// --- Login Request ---\ntry{// Make the actual request to your backend login route (now using POST)\nconst response=await axios.post(LOGIN_API_URL,{email,password});// Expect token, user object, and role from the backend\nconst{token,user}=response.data;// CRUCIAL: Store the token and the role\nsessionStorage.setItem('authToken',token);sessionStorage.setItem('userRole',user.role);// Store the actual role ('user' or 'admin')\nsetUser(user);setRole(user.role);setIsAuthenticated(true);setIsLoading(false);console.log(\"[AUTH] Logging in as User: \".concat(user.displayName||user.email,\" // Role: \").concat(user.role));return true;// Success\n}catch(error){var _error$response,_error$response$data;// Catch network or server-side errors and extract the error message\nconst errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Login failed. Network error or server down.';return errorMessage;}finally{setIsLoading(false);}};// --- Logout Function ---\nconst logout=()=>{// Clear storage and reset state\nsessionStorage.removeItem('authToken');sessionStorage.removeItem('userRole');setUser(null);setRole(null);setIsAuthenticated(false);setIsLoading(false);};// The object that makes the state and functions available to the app\nconst contextValue={user,isAuthenticated,role,isLoading,login,logout,token:sessionStorage.getItem('authToken')// Retrieves token from session storage\n};// If the initial check is running, display a loading screen\nif(isLoading){return/*#__PURE__*/_jsx(\"h1\",{children:\"Please wait a moment... :D\"});}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:children});};// Custom hook to use the AuthContext easily in any component\nexport const useAuth=()=>{return useContext(AuthContext);};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsx","_jsx","AuthContext","API_URL","LOGIN_API_URL","concat","AuthProvider","_ref","children","user","setUser","isAuthenticated","setIsAuthenticated","role","setRole","isLoading","setIsLoading","token","sessionStorage","getItem","storedRole","get","headers","Authorization","then","response","data","catch","logout","finally","login","email","password","post","setItem","console","log","displayName","error","_error$response","_error$response$data","errorMessage","message","removeItem","contextValue","Provider","value","useAuth"],"sources":["C:/Users/User/Documents/lostnfound_fullstack/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport axios from 'axios'; // Used for making API calls to your backend\r\n\r\n// 1. Create the Context object\r\nconst AuthContext = createContext(null);\r\n\r\n// Placeholder for your backend authentication URL\r\n// Update API_URL to use HTTPS and the correct path for login.\r\n// Replace 'yourdomain.com' with your actual domain name once deployed. \r\n// For local development, use http://localhost:3000\r\nconst API_URL = 'http://localhost:3000/api/auth'; \r\nconst LOGIN_API_URL = `${API_URL}/login`; // Will be the POST endpoint\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  // State variables for tracking authentication status\r\n  const [user, setUser] = useState(null);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [role, setRole] = useState(null); // Key for authorization: 'user' or 'admin'\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // --- Initial Check (Runs once when the app loads) ---\r\n  useEffect(() => {\r\n    // Check if we have stored credentials (token and role) from a previous session\r\n    const token = sessionStorage.getItem('authToken');\r\n    const storedRole = sessionStorage.getItem('userRole');\r\n\r\n    if (token && storedRole) {\r\n      \r\n      // --- Token Verification ---\r\n      // We use a simple GET request to verify the stored token is still valid\r\n      axios.get(`${API_URL}/verify-token`, { headers: { Authorization: `Bearer ${token}` }})\r\n        .then(response => {\r\n          // If the token is valid, the backend should return user data including the role\r\n          setUser(response.data.user); \r\n          setRole(response.data.user.role);\r\n          setIsAuthenticated(true);\r\n        })\r\n        .catch(() => {\r\n          logout(); // Token failed verification or expired\r\n        })\r\n        .finally(() => setIsLoading(false));\r\n      \r\n      /* // CHANGE 3: DELETE/COMMENT OUT the testing simulation logic\r\n      // *** TESTING SIMULATION LOGIC: KEEP FOR NOW ***\r\n      setUser({ name: 'Reloaded User', role: storedRole });\r\n      setRole(storedRole);\r\n      setIsAuthenticated(true);\r\n      // *** END TESTING SIMULATION LOGIC ***\r\n      */\r\n    } else {\r\n        // Only call this if no token was found\r\n        setIsLoading(false); \r\n    }\r\n  }, []);\r\n\r\n  // --- Login Function ---\r\n  const login = async (email, password) => {\r\n    setIsLoading(true);\r\n    \r\n    // --- Login Request ---\r\n    try {\r\n      // Make the actual request to your backend login route (now using POST)\r\n      const response = await axios.post(LOGIN_API_URL, { email, password });\r\n      \r\n      // Expect token, user object, and role from the backend\r\n      const { token, user } = response.data;\r\n      \r\n      // CRUCIAL: Store the token and the role\r\n      sessionStorage.setItem('authToken', token);\r\n      sessionStorage.setItem('userRole', user.role); // Store the actual role ('user' or 'admin')\r\n      \r\n      setUser(user);\r\n      setRole(user.role);\r\n      setIsAuthenticated(true);\r\n      setIsLoading(false);\r\n      console.log(`[AUTH] Logging in as User: ${user.displayName || user.email} // Role: ${user.role}`);\r\n      return true; // Success\r\n\r\n    } catch (error) {\r\n      // Catch network or server-side errors and extract the error message\r\n      const errorMessage = error.response?.data?.message || 'Login failed. Network error or server down.';\r\n      return errorMessage; \r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n    // --- Logout Function ---\r\n  const logout = () => {\r\n    // Clear storage and reset state\r\n    sessionStorage.removeItem('authToken'); \r\n    sessionStorage.removeItem('userRole');\r\n    \r\n    setUser(null);\r\n    setRole(null);\r\n    setIsAuthenticated(false);\r\n    setIsLoading(false);\r\n  };\r\n\r\n  // The object that makes the state and functions available to the app\r\n  const contextValue = {\r\n    user,\r\n    isAuthenticated,\r\n    role,\r\n    isLoading,\r\n    login,\r\n    logout,\r\n    token: sessionStorage.getItem('authToken'), // Retrieves token from session storage\r\n  };\r\n\r\n  // If the initial check is running, display a loading screen\r\n  if (isLoading) {\r\n    return <h1>Please wait a moment... :D</h1>; \r\n  }\r\n\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Custom hook to use the AuthContext easily in any component\r\nexport const useAuth = () => {\r\n  return useContext(AuthContext);\r\n};"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC7E,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAE;AAE3B;AAAA,OAAAC,GAAA,IAAAC,IAAA,yBACA,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAC,IAAI,CAAC,CAEvC;AACA;AACA;AACA;AACA,KAAM,CAAAQ,OAAO,CAAG,gCAAgC,CAChD,KAAM,CAAAC,aAAa,IAAAC,MAAA,CAAMF,OAAO,UAAQ,CAAE;AAE1C,MAAO,MAAM,CAAAG,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC;AACA,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACe,eAAe,CAAEC,kBAAkB,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAACiB,IAAI,CAAEC,OAAO,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAAE;AACxC,KAAM,CAACmB,SAAS,CAAEC,YAAY,CAAC,CAAGpB,QAAQ,CAAC,IAAI,CAAC,CAEhD;AACAE,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAmB,KAAK,CAAGC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAC,CACjD,KAAM,CAAAC,UAAU,CAAGF,cAAc,CAACC,OAAO,CAAC,UAAU,CAAC,CAErD,GAAIF,KAAK,EAAIG,UAAU,CAAE,CAEvB;AACA;AACArB,KAAK,CAACsB,GAAG,IAAAhB,MAAA,CAAIF,OAAO,kBAAiB,CAAEmB,OAAO,CAAE,CAAEC,aAAa,WAAAlB,MAAA,CAAYY,KAAK,CAAG,CAAC,CAAC,CAAC,CACnFO,IAAI,CAACC,QAAQ,EAAI,CAChB;AACAf,OAAO,CAACe,QAAQ,CAACC,IAAI,CAACjB,IAAI,CAAC,CAC3BK,OAAO,CAACW,QAAQ,CAACC,IAAI,CAACjB,IAAI,CAACI,IAAI,CAAC,CAChCD,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CAAC,CAAC,CACDe,KAAK,CAAC,IAAM,CACXC,MAAM,CAAC,CAAC,CAAE;AACZ,CAAC,CAAC,CACDC,OAAO,CAAC,IAAMb,YAAY,CAAC,KAAK,CAAC,CAAC,CAErC;AACN;AACA;AACA;AACA;AACA;AACA,QACI,CAAC,IAAM,CACH;AACAA,YAAY,CAAC,KAAK,CAAC,CACvB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAc,KAAK,CAAG,KAAAA,CAAOC,KAAK,CAAEC,QAAQ,GAAK,CACvChB,YAAY,CAAC,IAAI,CAAC,CAElB;AACA,GAAI,CACF;AACA,KAAM,CAAAS,QAAQ,CAAG,KAAM,CAAA1B,KAAK,CAACkC,IAAI,CAAC7B,aAAa,CAAE,CAAE2B,KAAK,CAAEC,QAAS,CAAC,CAAC,CAErE;AACA,KAAM,CAAEf,KAAK,CAAER,IAAK,CAAC,CAAGgB,QAAQ,CAACC,IAAI,CAErC;AACAR,cAAc,CAACgB,OAAO,CAAC,WAAW,CAAEjB,KAAK,CAAC,CAC1CC,cAAc,CAACgB,OAAO,CAAC,UAAU,CAAEzB,IAAI,CAACI,IAAI,CAAC,CAAE;AAE/CH,OAAO,CAACD,IAAI,CAAC,CACbK,OAAO,CAACL,IAAI,CAACI,IAAI,CAAC,CAClBD,kBAAkB,CAAC,IAAI,CAAC,CACxBI,YAAY,CAAC,KAAK,CAAC,CACnBmB,OAAO,CAACC,GAAG,+BAAA/B,MAAA,CAA+BI,IAAI,CAAC4B,WAAW,EAAI5B,IAAI,CAACsB,KAAK,eAAA1B,MAAA,CAAaI,IAAI,CAACI,IAAI,CAAE,CAAC,CACjG,MAAO,KAAI,CAAE;AAEf,CAAE,MAAOyB,KAAK,CAAE,KAAAC,eAAA,CAAAC,oBAAA,CACd;AACA,KAAM,CAAAC,YAAY,CAAG,EAAAF,eAAA,CAAAD,KAAK,CAACb,QAAQ,UAAAc,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBb,IAAI,UAAAc,oBAAA,iBAApBA,oBAAA,CAAsBE,OAAO,GAAI,6CAA6C,CACnG,MAAO,CAAAD,YAAY,CACrB,CAAC,OAAS,CACRzB,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAEC;AACF,KAAM,CAAAY,MAAM,CAAGA,CAAA,GAAM,CACnB;AACAV,cAAc,CAACyB,UAAU,CAAC,WAAW,CAAC,CACtCzB,cAAc,CAACyB,UAAU,CAAC,UAAU,CAAC,CAErCjC,OAAO,CAAC,IAAI,CAAC,CACbI,OAAO,CAAC,IAAI,CAAC,CACbF,kBAAkB,CAAC,KAAK,CAAC,CACzBI,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAED;AACA,KAAM,CAAA4B,YAAY,CAAG,CACnBnC,IAAI,CACJE,eAAe,CACfE,IAAI,CACJE,SAAS,CACTe,KAAK,CACLF,MAAM,CACNX,KAAK,CAAEC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAG;AAC9C,CAAC,CAED;AACA,GAAIJ,SAAS,CAAE,CACb,mBAAOd,IAAA,OAAAO,QAAA,CAAI,4BAA0B,CAAI,CAAC,CAC5C,CAGA,mBACEP,IAAA,CAACC,WAAW,CAAC2C,QAAQ,EAACC,KAAK,CAAEF,YAAa,CAAApC,QAAA,CACvCA,QAAQ,CACW,CAAC,CAE3B,CAAC,CAED;AACA,MAAO,MAAM,CAAAuC,OAAO,CAAGA,CAAA,GAAM,CAC3B,MAAO,CAAAlD,UAAU,CAACK,WAAW,CAAC,CAChC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}